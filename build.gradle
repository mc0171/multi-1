buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'net.researchgate:gradle-release:2.3.4'
    }
}

snapshotVersion = '0.0.0'

task(updateSubs) << {
  FileTree tree = fileTree(project.projectDir) {
    exclude(['build.gradle'])
    include(['properties.gradle','Dockerfile'])
  }
  tree.each {File file ->
    println "Tree file name: " + file
    if (file.text.contains('SNAPSHOT')) {
      println "Tree file contains: SLAPSHOT"
      def updated = file.text.replaceAll('SNAPSHOT','SLAPSHOT')
      file.write(updated)
      println "Tree file updated: SLAPSHOT"
    }
  }
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'net.researchgate.release'

    repositories {
        mavenCentral()
        jcenter()
    }

    release {
        tagTemplate = '$name-$version'
        failOnSnapshotDependencies = false
    }

    task(startMessage) << {
        println 'starting build'
    }

    task(printVersion) << {
        println "Project version is " + project.version
    }
    
    task(printSnapshotVersion) << {
        println "Project snapshot version is " + snapshotVersion
    }

    task(setSnapshotVersion) << {
        snapshotVersion = project.version
    }

    checkUpdateNeeded.dependsOn printVersion,setSnapshotVersion
    unSnapshotVersion.dependsOn printVersion,printSnapshotVersion
    beforeReleaseBuild.dependsOn startMessage,printVersion,printSnapshotVersion
    commitNewVersion.dependsOn printVersion
    afterReleaseBuild.dependsOn printVersion
}
